import{h}from"./chunk-MO3H5P22.js";import{Ka as u,Ob as s,Qb as d,X as n,a as c,aa as I,b as m}from"./chunk-CCEDBA4J.js";var l=class o{constructor(t){this.authService=t;d(()=>{this.authService.currentUser()||this.clearCart()})}STORAGE_KEY="shopping_cart";cartItemsSignal=u(this.getCartFromStorage());cartItems=this.cartItemsSignal.asReadonly();totalItems=s(()=>this.cartItems().reduce((t,e)=>t+e.quantity,0));totalPrice=s(()=>this.cartItems().reduce((t,e)=>t+e.product.price*e.quantity,0));cart=s(()=>({items:this.cartItems(),totalItems:this.totalItems(),totalPrice:this.totalPrice()}));addToCart(t,e=1){let a=this.cartItems(),r=a.findIndex(i=>i.product.id===t.id);if(r!==-1){let i=[...a];i[r]=m(c({},i[r]),{quantity:i[r].quantity+e}),this.cartItemsSignal.set(i)}else this.cartItemsSignal.set([...a,{product:t,quantity:e}]);this.saveCartToStorage()}updateQuantity(t,e){if(e<=0){this.removeFromCart(t);return}let a=this.cartItems().map(r=>r.product.id===t?m(c({},r),{quantity:e}):r);this.cartItemsSignal.set(a),this.saveCartToStorage()}removeFromCart(t){let e=this.cartItems().filter(a=>a.product.id!==t);this.cartItemsSignal.set(e),this.saveCartToStorage()}clearCart(){this.cartItemsSignal.set([]),localStorage.removeItem(this.STORAGE_KEY)}getCartFromStorage(){let t=localStorage.getItem(this.STORAGE_KEY);return t?JSON.parse(t):[]}saveCartToStorage(){localStorage.setItem(this.STORAGE_KEY,JSON.stringify(this.cartItems()))}static \u0275fac=function(e){return new(e||o)(I(h))};static \u0275prov=n({token:o,factory:o.\u0275fac,providedIn:"root"})};export{l as a};
