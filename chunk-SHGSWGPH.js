import{a as O}from"./chunk-EE4IVITP.js";import{h as u}from"./chunk-MO3H5P22.js";import{Ka as c,X as n,a,aa as o,b as d}from"./chunk-CCEDBA4J.js";var h=class s{constructor(r,e){this.cartService=r;this.authService=e}STORAGE_KEY="orders";ordersSignal=c(this.getOrdersFromStorage());orders=this.ordersSignal.asReadonly();nextOrderId=this.calculateNextOrderId();getAllOrders(){return this.orders()}getUserOrders(){let r=this.authService.currentUser();return r?this.orders().filter(e=>e.userId===r.id):[]}getOrderById(r){return this.orders().find(e=>e.id===r)}createOrder(r){let e=this.authService.currentUser();if(!e)return null;let t=this.cartService.cart();if(t.items.length===0)return null;let i={id:this.nextOrderId++,userId:e.id,items:[...t.items],total:t.totalPrice,date:new Date,status:"pending",shippingAddress:r},l=[...this.orders(),i];return this.ordersSignal.set(l),this.saveOrdersToStorage(),this.cartService.clearCart(),i}updateOrderStatus(r,e){let t=this.orders().map(i=>i.id===r?d(a({},i),{status:e}):i);this.ordersSignal.set(t),this.saveOrdersToStorage()}getOrdersFromStorage(){let r=localStorage.getItem(this.STORAGE_KEY);return r?JSON.parse(r).map(t=>d(a({},t),{date:new Date(t.date)})):[]}saveOrdersToStorage(){localStorage.setItem(this.STORAGE_KEY,JSON.stringify(this.orders()))}calculateNextOrderId(){let r=this.orders();return r.length>0?Math.max(...r.map(e=>e.id))+1:1}static \u0275fac=function(e){return new(e||s)(o(O),o(u))};static \u0275prov=n({token:s,factory:s.\u0275fac,providedIn:"root"})};export{h as a};
